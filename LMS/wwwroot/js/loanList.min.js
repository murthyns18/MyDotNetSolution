function dateFormatter(n){return n?new Date(n).toLocaleDateString("en-IN"):""}function dueDateFormatter(n,t,i){if(!n)return"";var r=new Date(n),u=new Date;return!i.returnDate&&r<u?`<span class="text-danger fw-bold">
                    ${r.toLocaleDateString("en-IN")}
                </span>`:r.toLocaleDateString("en-IN")}function loanStatusFormatter(n,t,i){return i.returnDate?"<span class='badge bg-secondary'>Returned<\/span>":i.dueDate&&new Date(i.dueDate)<new Date?"<span class='badge bg-danger'>Overdue<\/span>":"<span class='badge bg-success'>Active<\/span>"}function loanStatusUnFormatter(n,t,i){return $(i).text()}function loanActionFormatter(n,t,i){var r=$('input[name="__RequestVerificationToken"]').val(),u=i.returnDate!==null,f=i.dueDate&&new Date(i.dueDate)<new Date;return`
    <div style="white-space:nowrap;">
        <button class="btn btn-sm btn-info me-1"
                title="View Loan"
                onclick="viewLoanDetails(${i.loanId})">
            <i class="bi bi-eye"></i>
        </button>

        ${u?"":`
        <form method="post"
              action="/Loan/ReturnLoan"
              style="display:inline;">
            <input type="hidden" name="loanId" value="${i.loanId}" />
            <input type="hidden" name="__RequestVerificationToken" value="${r}" />
            <button class="btn btn-sm btn-success"
                    title="Return Loan"
                    ${f?"disabled":""}>
                <i class="bi bi-arrow-return-left"></i>
            </button>
        </form>`}
    </div>`}function viewLoanDetails(n){$.get("/Loan/LoanDetails",{loanId:n},function(n){$("#loanDetailsBody").html(n);$("#loanDetailsModal").modal("show")})}function openAddLoanModal(){var t=new Date,n;$("#loanDate").val(t.toLocaleDateString("en-IN"));n=new Date;n.setDate(n.getDate()+7);$("#dueDate").val(n.toLocaleDateString("en-IN"));loadBorrowers();loadAvailableBooks();$("#addLoanModal").modal("show")}function loadBorrowers(){$.get("/User/GetUsersForDropdown",function(n){$("#borrowerId").empty().append(`<option value="">-- Select Borrower --</option>`);n.forEach(n=>{$("#borrowerId").append(`<option value="${n.userId}">${n.userName}</option>`)})})}function loadAvailableBooks(){$.get("/Book/GetAvailableBooks",function(n){var t="";n.forEach(n=>{t+=`
                <div class="form-check">
                    <input class="form-check-input book-check"
                           type="checkbox"
                           value="${n.bookId}">
                    <label class="form-check-label">
                        ${n.title} (Qty: ${n.quantity})
                    </label>
                </div>`});$("#bookList").html(t)})}function submitLoan(){var t=$("#borrowerId").val(),n,i;if(!t){alert("Please select borrower");return}if(n=[],$(".book-check:checked").each(function(){n.push(parseInt($(this).val()))}),n.length===0){alert("Please select at least one book");return}i={borrowerId:t,loanDate:(new Date).toISOString(),bookIds:n};$.ajax({url:"/Loan/TakeLoan",type:"POST",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()},contentType:"application/json",data:JSON.stringify(i),success:function(){$("#addLoanModal").modal("hide");$("#loanGrid").trigger("reloadGrid")},error:function(){alert("Failed to take loan")}})}$(function(){$("#loanGrid").jqGrid({url:"/Loan/GetLoansForGrid",datatype:"json",mtype:"GET",colModel:[{label:"Action",width:110,fixed:!0,align:"center",sortable:!1,search:!1,formatter:loanActionFormatter,cellattr:()=>"style='white-space:nowrap;'"},{name:"loanId",key:!0,hidden:!0},{label:"Borrower",name:"borrowerName",width:200},{label:"Loan Date",name:"loanDate",width:120,formatter:dateFormatter},{label:"Due Date",name:"dueDate",width:120,formatter:dueDateFormatter},{label:"Status",width:120,align:"center",formatter:loanStatusFormatter,unformat:loanStatusUnFormatter,stype:"select",searchoptions:{value:":All;Active:Active;Overdue:Overdue;Returned:Returned"}}],pager:"#loanPager",rowNum:10,rowList:[10,20,50],autowidth:!0,shrinkToFit:!0,height:"auto",loadonce:!0,viewrecords:!0,caption:"<i class='bi bi-journal-text'><\/i> Loan List",rowattr:function(n){if(!n.returnDate&&n.dueDate&&new Date(n.dueDate)<new Date)return{"class":"table-warning"}},jsonReader:{root:"rows",records:"records",repeatitems:!1,id:"loanId"}});$("#loanGrid").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!1,defaultSearch:"cn"})});$(window).on("resize",function(){var n=$("#loanGrid").closest(".container-fluid").width();$("#loanGrid").jqGrid("setGridWidth",n,!0)});
//# sourceMappingURL=loan.min.js.map